var tongDonHang = 0;
var tongTienDuocGiamMggShopee=0;
var tongTienDuocGiamMggShopeeShop=0;
var tongTienChiTieu = 0;/*G·ªìm +ship*/
var tongTienHangGiamGia = 0;/*Ch∆∞a +ship*/
var tongTienHang=0;/*Ch∆∞a +ship +ch∆∞a discount*/
var tongTienTietKiem=0;
var tongTienVanChuyenChuaGiam = 0;
var tongTienVanChuyenDuocGiam = 0;
var tongSanPhamDaMua = 0;
var trangThaiDonHangConKhong = true;
var offset = 0;
var si = 8;
var tongTienVanChuyenPhaiTra=0;
function xemBaoCaoThongKe() {
	var orders = [];
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			orders = JSON.parse(this.responseText)['data']['details_list'];
			if(orders!=undefined){
				tongDonHang += orders.length;
				trangThaiDonHangConKhong = orders.length <= si;
				orders.forEach(order => {
	                tongTienChiTieu +=order['info_card']['final_total'] / 100000;
	                order['info_card']['order_list_cards'].forEach(item => {
	                    item['items'].forEach(data => {
							tongSanPhamDaMua += data["amount"];
							tongTienHangGiamGia+=(data['order_price']/ 100000)*data["amount"];
							if(data['price_before_discount']!=undefined){
								tongTienHang+=(data['price_before_discount']/ 100000)*data["amount"];
							}else{
								tongTienHang+=(data['order_price']/ 100000)*data["amount"];
							}
						});
	                });
				});
				offset += si;
				console.log('ƒê√£ th·ªëng k√™ ƒë∆∞·ª£c: ' + tongDonHang + ' ƒë∆°n h√†ng');
			}else{
				trangThaiDonHangConKhong=false;
			}
			if(trangThaiDonHangConKhong) {
				console.log('ƒê·ª£i ch√∫t polyxgo ƒëang x·ª≠ l√Ω...');
				xemBaoCaoThongKe();
			}
			else {
				tongTienHangTietKiem=tongTienHang-tongTienHangGiamGia;
				tongTienVanChuyenPhaiTra=tongTienChiTieu-tongTienHangGiamGia;
				tongTienChiTieuX=pxgPrice(tongTienChiTieu);
				console.log("================================");
				console.log("%c"+PXGCert(tongTienChiTieuX), "font-size:26px;");
				console.log("%cH·∫øt c√≥: "+"%c"+tongTienChiTieuX+" vnƒë%c ch·ª© nhi√™u h√¨ h√¨", "font-size: 20px;","font-size: 26px; color:red;font-weigth:700", "font-size: 20px;");
				console.log("================================");
				console.log("%cT·ªïng ƒë∆°n h√†ng ƒë√£ giao: "+"%c"+pxgPrice(tongDonHang)+" ƒë∆°n h√†ng", "font-size: 26px;","font-size: 26px; color:green");
                console.log("%cT·ªïng s·∫£n ph·∫©m ƒë√£ ƒë·∫∑t: " + "%c" + pxgPrice(tongSanPhamDaMua)+" s·∫£n ph·∫©m", "font-size: 20px;","font-size: 20px; color:#fc0000");
                console.log("%cüí≤T·ªïng ti·ªÅn h√†ng: "+"%c"+pxgPrice(tongTienHangGiamGia)+" vnƒë", "font-size: 20px;","font-size: 20px; color:#fc0000");
                console.log("%cüí∞T·ªïng ti·ªÅn h√†ng ti·∫øt ki·ªám: "+"%c"+pxgPrice(tongTienHangTietKiem)+" vnƒë", "font-size: 20px;","font-size: 26px; color:green");
                console.log("%cüí≤T·ªïng ti·ªÅn v·∫≠n chuy·ªÉn ƒë√£ tr·∫£: "+"%c"+pxgPrice(tongTienVanChuyenPhaiTra)+" vnƒë", "font-size: 20px;","font-size: 20px; color:#fc0000");
				console.log("%cüí≤T·ªïng ti·ªÅn h√†ng + ti·ªÅn ship: "+"%c"+tongTienChiTieuX+" vnƒë", "font-size: 26px;","font-size: 26px; color:#fc0000");
				console.log("================================");
				console.log("%cüî¥Nh·∫≠n m√£ gi·∫£m gi√° "+getDate()+"üî•", "font-size: 26px;");
				console.log("%cüëâShopee khung gi·ªù: "+"%chttps://mggshopee.net", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("%cüëâLazada: "+"%chttps://mgglazada.com", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("%cüëâTiki: "+"%chttps://mggtiki.com", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("%cüëâƒêi·ªán M√°y XANH: "+"%chttps://magiamgiadienmayxanh.com", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("%cüëâTh·∫ø Gi·ªõi Di ƒê·ªông: "+"%chttps://magiamgiathegioididong.com", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("================================");
				console.log("%c‚úÖXem l·ªãch s·ª≠ gi√° s·∫£n ph·∫©m tƒÉng/ gi·∫£m", "font-size: 26px;");
				console.log("%cüëâLichSuGia.vn: "+"%chttps://lichsugia.vn", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("%cüëâTi·ªán √≠ch tra L·ªãch S·ª≠ Gi√° VN: "+"%chttps://thank.zone/LichSuGiaVNExt", "font-size: 18px;","font-size: 18px; color:#fc0000");
			}
		}
	};
	xhttp.open("GET", "https://shopee.vn/api/v4/order/get_order_list?list_type=3&offset="+offset+"&limit="+si,true);
	xhttp.send();
}
const getDate = () => {
  const newDate = new Date();
  const year = newDate.getFullYear();
  const month = newDate.getMonth() + 1;
  const d = newDate.getDate();
  
  return `${d.toString()}/${month.toString()}/${year}`;
}
function PXGCert(pri){
  if(pri<=10000000){
  	return "B·∫°n mua s·∫Øm c≈©ng TH∆Ø·ªúNG ha";
  }else if(pri>10000000 &&pri<=50000000){
  	return "B·∫°n mua s·∫Øm c≈©ng T√ÄM T·∫†M ha";
  }else if(pri>50000000 &&pri<80000000){
  	return "B·∫°n mua s·∫Øm h∆°i b·ªã KINH ƒê√ì h∆°";
  }else{
  	return "B·∫°n l√† b·∫≠c th·∫ßy mua s·∫Øm, l√† TH√ÅNH SHOPEE kaka";
  }
}
function pxgPrice(number, fixed=0) {
	if(isNaN(number)) return 0;
	number = number.toFixed(fixed);
	let delimeter = ',';
	number += '';
	let rgx = /(\d+)(\d{3})/;
	while (rgx.test(number)) {
		number = number.replace(rgx, '$1' + delimeter + '$2');
	}
	return number;
}
xemBaoCaoThongKe();
